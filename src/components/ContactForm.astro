---
// src/components/ContactForm.astro
---

<div class="max-w-xl mx-auto p-6 bg-white shadow-lg rounded-xl border border-gray-100">
  
  <div id="form-success" class="hidden text-center py-8">
    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
      <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
    </div>
    <h3 class="text-2xl font-bold text-gray-900">Message Sent!</h3>
    <p class="text-gray-600 mt-2">We have received your details. A compliance officer will contact you shortly.</p>
    <button onclick="window.location.reload()" class="mt-6 px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition">
      Send Another Message
    </button>
  </div>

  <form 
    id="compliance-form"
    name="contact" 
    method="POST" 
    data-netlify="true" 
    class="space-y-6"
  >
    <input type="hidden" name="form-name" value="contact" />

    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
      <input 
        type="text" 
        name="name" 
        id="name" 
        required 
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition"
        placeholder="Enter your name"
      />
    </div>

    <div>
      <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
      <input 
        type="email" 
        name="email" 
        id="email" 
        required 
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition"
        placeholder="john@example.com"
      />
    </div>

    <div>
      <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
      <input 
        type="tel" 
        name="phone" 
        id="phone" 
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition"
        placeholder="082 123 4567"
      />
    </div>

    <div>
      <label for="service" class="block text-sm font-medium text-gray-700 mb-1">Service Required</label>
      <select 
        name="service" 
        id="service" 
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-brand-primary outline-none transition bg-white"
      >
        <option value="New Company Registration">New Company Registration</option>
        <option value="Annual Returns">Annual Returns</option>
        <option value="Director Changes">Director Changes</option>
        <option value="Restoration">Company Restoration</option>
        <option value="COIDA">COIDA / Letter of Good Standing</option>
        <option value="Other">Other Query</option>
      </select>
    </div>

    <button 
      type="submit" 
      class="w-full py-3 px-4 bg-brand-primary hover:bg-brand-secondary text-white font-bold rounded-lg shadow-md hover:shadow-lg transition duration-200 flex justify-center items-center gap-2"
    >
      <span>Start Registration</span>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
    </button>
    
    <p class="text-xs text-center text-gray-500 mt-4">
      By clicking submit, you agree to our privacy policy. Your data is secure.
    </p>
  </form>
</div>

<script>
  const handleSubmit = (event) => {
    event.preventDefault(); 
    const myForm = event.target;
    const formData = new FormData(myForm);

    fetch("/", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams(formData).toString(),
    })
    .then((response) => {
      if (response.ok) {
        // Success!
        document.getElementById('compliance-form').classList.add('hidden');
        document.getElementById('form-success').classList.remove('hidden');
      } else {
        // Server returned an error (like 404)
        alert("Submission failed. The server could not process the form.");
      }
    })
    .catch((error) => {
      alert("Network error. Please check your connection.");
    });
  };

  document.querySelector("form").addEventListener("submit", handleSubmit);
</script>
